ARG php-version=82

PKG nginx htop 
PKG nextcloud-php${php-version} nextcloud-calendar-php${php-version} nextcloud-contacts-php${php-version} nextcloud-deck-php${php-version} nextcloud-mail-php${php-version}

CMD mkdr -p /www/certificates 
CMD mkdir -p /usr/local/etc/git_config/nextcloud

MOUNT /werzel/certificates www/certificates nullfs ro 0 0
MOUNT /werzel/nextcloud usr/local/www/nextcloud/data nullfs rw 0 0
MOUNT /werzel/server_config/php usr/local/etc/git_config/php nullfs ro 0 0
MOUNT /werzel/server_config/nextcloud usr/local/etc/git_config/nextcloud nullfs ro 0 0

# Link Configurations to /usr/local/etc/ from /usr/local/etc/git_config/*/
CMD rm -rf /usr/local/www/nextcloud/config/config.php
CMD ln -s /usr/local/etc/git_config/nextcloud/config.php /usr/local/www/nextcloud/config/config.php 
CMD ln -s /usr/local/etc/git_config/nginx/nextcloud.conf /usr/local/etc/nginx/sites.d/nextcloud.conf 
CMD ln -s /usr/local/etc/git_config/php/nextcloud.conf /usr/local/etc/php/sites.conf/nextcloud.conf 

SYSRC php_fpm_enable=YES
SYSRC nginx_enable=YES

SERVICE php-fpm start
SERVICE nginx start
